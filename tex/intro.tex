\section{Introduction}
\label{sec:intro}

\textbf{What are covariance models used for, relevant to us?}\\
Geophysical inverse problems, such as numerical weather prediction \red{cite} or
oceanographic state estimation \red{cite}, are typically ill-posed due to the
sparsity of data relative to the size of the control vector.
A classical method for handling this ill-posedness is to prescribe some estimate
of the background-state error, capturing our degree of confidence in the
control vector at a given point in space and time \red{cite}.
In deterministic inverse problems, this is referred to as regularization and
corresponds to prior information in the probabilistic sense.
For all practical applications, true knowledge of the background state error
must be approximated.
A common approach is to prescribe a static covariance, where standard
deviations and length-scales that describe the covariance are captured by
various parameters.
\red{Dynamic error covariance?}

For applications with simple geometries, covariance models can be specified with
simple exponential functions.
However, alternative approaches are required for more complicated domains,
such as oceanographic state estimation,
where irregular continental boundaries impede the use of spherical harmonics or
more straightforward analytical functions.
In such applications, it is advantageous to cast the background-state covariance
in terms of geophysical coordinates and employ models based on differential
equations which have some correspondence to covariance information.
\red{More overview}

In oceanographic state estimation, the most widely used static background state
covariance model is based on the work by \citet[][WC01
hereafter]{weaver_correlation_2001},
\citep[e.g.][]{forgetECCOv4,nguyen_arctic_2021,mazloff_eddy-permitting_2010,moore_regional_2011-1}.
\begin{itemize}
    \item Specify correlation via diffusion operator
    \item normalize by standard deviation
    \item re-scale to achieve desired background state error covariance
\end{itemize}
This has the advantages of being
\begin{itemize}
    \item scalable to high dimensions
    \item handles boundaries well
\end{itemize}
However,
\begin{itemize}
    \item To achieve anisotropy due to vastly different correlation
        length-scales in the horizontal compared to the vertical, requires the
        assumption of separability. This seems to work in practice even though
        there is no true justification for it, but comes at the computational
        expense of applying
        solving an explicit diffusion equation twice - once for the horizontal
        and again for the vertical.
    \item The number of pseudo time steps required for this diffusion solve to
        be numerically stable requires some trial and error. In WC01, the
        authors provide a minimum threshold, but in practice this is not
        sufficiently long enough, requiring some trial and error to determine
        the appropriate integration time.
\end{itemize}



\subsection{Old intro}
A fundamental requirement for the inverse problem that we address in this work
is the specification of a prior distribution, $\priorDist(\params)$.
Recall from chapter XX that the multivariate control vector
$\params$ consists of the
potential temperature, salinity, and zonal velocity at the western boundary of
the domain:
$\params \coloneqq [\thetaParams^T,\saltParams^T,\uvelParams^T]^T \in\paramSpace$.
As is common in large scale geophysical inverse problems, we specify the prior
distribution for the control vector
to be Gaussian: $\priorDist(\params) \coloneqq \mathcal{N}(\params_0, \priorCovMat)$.

Our first objective in the inverse problem is to specify the prior
covariance $\priorCovMat$.
To do this, we obtain univariate prior covariances for
each individual field: $\thetaPriorCovMat$, $\saltPriorCovMat$,
$\uvelPriorCovMat$, which are then stacked block-diagonally to form
$\priorCovMat$ (see below for details).
Our primary focus in this chapter is to describe the generic formulation for
each of these univariate covariance matrices.
To facilitate the discussion, we refer to a generic univariate control variable
$\uni(\x)$ (or $\unis$ upon discretization), which in our specific case is a
placeholder for temperature, salinity, and zonal velocity, and is similarly
applicable to other inverse problems.
We use the general methodology outlined here to specify a prior covariance in
chapter XX.

In oceanographic inverse problems, covariance models must address at least
these three issues.
\begin{enumerate}
    \item Irregular boundaries imposed by continents
    \item Anisotropy due to the shallow fluid-like nature of the ocean
    \item Multivariate control parameters
\end{enumerate}
It is common to use covariance models based on differential operators in order
to handle irregular boundaries, and the question is then how to address the
other two issues within a differential equation.

A common approach to specifying the prior covariance in oceanographic inverse
problems is based on a generalized
diffusion equation \citep{weaver_correlation_2001}.
In this chapter, we outline an alternative approach that brings some practical
advantages which are discussed in section \ref{sec:matern_discussion}.
%#that has a similar structure to the
%#this model, but employs a version of the differential
%#operator presented in \citet{RSSB:RSSB777}.
%The general methodology is as follows.
We define a differential operator that can be represented by the matrix $C$,
that follows the flexible development from \citet{RSSB:RSSB777}.
We note that the matrix form is used for convenience, but that matrices are
never explicitly formed.
We show that the operator $C$ specifies the covariance matrix $CC^T$, that
is almost identical to a Mat\'ern covariance aside from boundary affects
imposed by $C$.
We then augment this differential operator with a sequence of factors that
are suggested by \citet{weaver_correlation_2001}.
That is, we incorporate the sequence of operations:
$\Sigma X C $, where
\begin{linenomath*}\begin{equation*}
    X \coloneqq \text{diag}\left\{ 1/\hat{\sigma}_{i}\right\}_{i=1}^{N}
\end{equation*}\end{linenomath*}
is a
normalization matrix computed from the pointwise marginal variance at grid cell
$i$: $\hat{\sigma}^2_{i}$, and
\begin{linenomath*}\begin{equation*}
    \Sigma \coloneqq \text{diag}\left\{\sigma_\uni\right\}_{i=1}^{\nuni}
\end{equation*}\end{linenomath*}
is the specified magnitude of prior uncertainty (standard deviation) for a
generic univariate parameter field $\unis\in\uniSpace$ (e.g.\ initial temperature).
With these definitions, $XCC^TX$ is a correlation matrix, and
\begin{linenomath}\begin{equation}
    \Gamma_\uni \coloneqq \Sigma X C C^T X \Sigma =
    \Gamma_\uni^{1/2}\Gamma_\uni^{T/2}
\end{equation}\end{linenomath}
defines the covariance for a generic univariate parameter field $\unis$.

The full prior covariance for a general multivariate application is then formed
by specifying individual covariance operators as above, and stacking them
together block diagonally.
To be concrete, the prior covariance for the specific inverse problem in this
work, i.e. for the steady state temperature, salinity,
and velocity fields at the open boundary of the computational domain,
is formulated as
\begin{linenomath*}\begin{equation*}
    \priorCovMat \coloneqq
    \begin{pmatrix}
        \thetaPriorCovMat & & \\
        & \saltPriorCovMat & \\
        & & \uvelPriorCovMat \\
    \end{pmatrix} \, .
\end{equation*}\end{linenomath*}
To keep this chapter general, we focus on specifying the covariance for a generic
univariate control parameter, $\uni(\x)$ which can be considered a placeholder
for each variable temperature, salinity, and velocity separately.
We wait until
chapter xx to discuss the specification of the prior
for each parameter, as this is becomes specific to our application.
Finally, we note that nonzero off diagonal terms in $\priorCovMat$ above (or an
additional operator) could be used to specify cross covariance between each
variable.
We consider this future work, and discuss potential options in
section XX.

In the following sections we review the general Mat\'ern type covariance
form that is suggested by \citet{RSSB:RSSB777}.
We then develop the differential operator, $C$, that
forms the backbone of our covariance model.
We show that our numerical implementation of the covariance model produces correlation
length scales that are expected from the analysis in section
\ref{sec:matern_operator}.
We conclude by discussing some advantages that this approach offers.
